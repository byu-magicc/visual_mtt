<?xml version="1.0" encoding="UTF-8"?>

<launch>

  <arg name="videopath"   default="" />
  <arg name="fps"         default="24" />
  <arg name="camera"      default="camera" />

  <arg name="bagpath"     default="" />
  <arg name="imgtopic"    default="/video" />
  <arg name="compressed"  default="false" />

  <arg name="params"      default="default" />
  <arg name="tuning"      default="true" />
  <arg name="show_tracks" default="true" />

  <!-- videopath:     path to video file            (video only)            -->
  <!-- fps:           desired framerate             (video only)            -->
  <!-- camera:        camera parameter file         (video only)            -->

  <!-- bagpath:       path to recording             (rosbag only)           -->
  <!-- imgtopic:      set to topic from recording   (rosbag only)           -->
  <!-- compressed:    set if compressed             (rosbag only)           -->

  <!-- params:        name of .yaml contained the desired parameter values  -->
  <!-- tuning:        enables dynamic reconfigure and displays measurements -->
  <!-- show_tracks:   enables display of tracking results                   -->

  <!-- #################################################################### -->

  <!-- decompress video if needed -->
  <node if="$(arg compressed)"
    pkg="image_transport"
    type="republish"
    name="republish"
    output="log"
    args="compressed in:=$(arg imgtopic) raw out:=$(arg imgtopic)">
  </node>

  <!-- launch visual_mtt -->
  <include file="$(find visual_mtt2)/launch/visual_mtt.launch">
    <arg name="params" value="$(arg params)"/>
    <arg name="tuning" value="$(arg tuning)"/>
    <arg name="show_tracks" value="$(arg show_tracks)"/>
    <arg name="imgtopic" value="$(arg imgtopic)"/>
  </include>

  <!-- play video and simulate camera -->
  <node unless="$(eval videopath == '')" pkg="visual_mtt2" type="video_player.py" name="player" output="screen">
    <param name="input" value="$(arg videopath)"/>
    <param name="fps" value="$(arg fps)"/>
    <remap from="output" to="$(arg imgtopic)"/>
  </node>
  <node unless="$(eval videopath == '')" pkg="visual_mtt2" type="camera_sim" name="camera_sim" output="screen">
    <!-- <param name="video_device" value="$(arg device)" /> -->
    <!-- <param name="image_width" value="640" /> -->
    <!-- <param name="image_height" value="480" /> -->
    <!-- <param name="pixel_format" value="yuyv" /> -->
    <!-- <param name="camera_frame_id" value="usb_cam" /> -->
    <!-- <param name="io_method" value="mmap"/> -->
    <!-- <param name="framerate" value="30" /> -->
    <param name="camera_info_path" value="file://$(find visual_mtt2)/param/$(arg camera).yaml"/>
    <!-- <param name="camera_name" value="chiny_cam" /> -->
    <remap from="input" to="$(arg imgtopic)"/>
    <remap from="output" to="camera/image"/>
  </node>

  <!-- play rosbag -->
  <param unless="$(eval bagpath == '')" name="use_sim_time" type="bool" value="true"/>
  <node unless="$(eval bagpath == '')" pkg="rosbag" type="play" name="player" args="-l $(arg bagpath) --clock" launch-prefix="xterm -e"/>

</launch>